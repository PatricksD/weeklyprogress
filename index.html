<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Weekly Progress</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%230a0e14'/%3E%3Cpath d='M30 52 l12 12 l28-28' stroke='%233fb950' stroke-width='12' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAYAAACZgo39AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFm0lEQVR4nO2dS2hcVRSGv3NfM5M0U6S2pS1NfSAtpS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0itS0
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --bg-color: #0a0e14;
            --card-color: #161b22;
            --text-color: #f0f6fc;
            --accent-color: #3fb950; 
            --empty-dot: #21262d;
            --bonus-color: #f1e05a; 
            --overdrive-purple: #a371f7;
            --overdrive-glow: #8957e5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 15px;
            display: flex; justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .container { width: 100%; max-width: 500px; padding-bottom: 100px; }
        .view-section { display: none; animation: fadeIn 0.2s ease-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        header { margin-bottom: 25px; text-align: center; padding-top: 10px; }
        h1 { margin: 0; font-size: 1.6rem; font-weight: 800; color: #fff; letter-spacing: -0.5px; }
        .week-label { font-size: 0.9rem; color: #8b949e; margin: 5px 0 15px; font-weight: 500; }

        .progress-container {
            height: 34px; background-color: #21262d; border-radius: 17px;
            overflow: hidden; position: relative; border: 1px solid #30363d;
            display: flex; align-items: center; justify-content: center;
        }
        .progress-bar {
            position: absolute; left: 0; top: 0; bottom: 0;
            background-color: var(--accent-color); width: 0%;
            transition: width 0.8s cubic-bezier(0.22, 1, 0.36, 1), background-color 0.4s ease;
            z-index: 1;
        }
        .progress-text { position: relative; z-index: 2; font-size: 12px; font-weight: 800; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        .progress-bar.overdrive { background-color: var(--overdrive-purple); box-shadow: 0 0 20px var(--overdrive-glow); animation: pulseGlow 1.5s infinite alternate ease-in-out; }
        @keyframes pulseGlow { from { filter: brightness(1); } to { filter: brightness(1.3); } }

        .task-list { display: flex; flex-direction: column; gap: 12px; }
        .task-card { background-color: var(--card-color); padding: 18px; border-radius: 16px; border: 1px solid #30363d; }
        .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .task-title { font-weight: 600; font-size: 1rem; color: #c9d1d9; cursor: pointer; }
        .counter-text { color: #8b949e; font-weight: 400; font-size: 0.8rem; margin-left: 5px; cursor: pointer; }
        
        .dots-container { display: flex; flex-wrap: wrap; gap: 10px; }
        .dot { width: 34px; height: 34px; border-radius: 8px; background-color: var(--empty-dot); transition: 0.2s; border: 1px solid #30363d; cursor: pointer; }
        .dot.filled { background-color: var(--accent-color); transform: scale(1.05); border-color: transparent; }
        .dot.bonus { border-color: var(--bonus-color); background-color: transparent; }
        .dot.bonus.filled { background-color: var(--bonus-color); box-shadow: 0 0 8px rgba(241, 224, 90, 0.3); border-color: transparent; }
        
        .add-bonus-btn { 
            width: 34px; height: 34px; border-radius: 8px; border: 1px dashed #484f58; 
            position: relative; cursor: pointer; background: transparent;
        }
        .add-bonus-btn::before, .add-bonus-btn::after {
            content: ''; position: absolute; background-color: #8b949e;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .add-bonus-btn::before { width: 14px; height: 2px; }
        .add-bonus-btn::after { width: 2px; height: 14px; }

        .input-area { margin-top: 25px; display: flex; gap: 8px; }
        input { background: #0d1117; border: 1px solid #30363d; color: #fff; padding: 12px; border-radius: 10px; font-size: 16px; flex-grow: 1; outline: none; }
        input[type="number"] { width: 60px; flex-grow: 0; text-align: center; }
        .add-btn { background: #238636; border: none; border-radius: 10px; padding: 0 20px; font-weight: 700; color: #fff; cursor: pointer; }

        .history-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .history-card { background: var(--card-color); border: 1px solid #30363d; border-radius: 16px; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .ring-container { width: 70px; height: 70px; border-radius: 50%; position: relative; display: flex; align-items: center; justify-content: center; background: #21262d; margin: 10px 0; }
        .ring-inner { width: 56px; height: 56px; background: var(--card-color); border-radius: 50%; position: absolute; z-index: 2; }
        .ring-fill { position: absolute; inset: 0; border-radius: 50%; z-index: 1; }
        .ring-text { z-index: 3; font-weight: 800; font-size: 0.85rem; }

        .data-section { margin-top: 40px; padding: 20px; border-top: 1px solid #30363d; text-align: center; }
        .data-btn { background: none; border: 1px solid #30363d; color: #8b949e; padding: 8px 15px; border-radius: 8px; font-size: 0.7rem; margin: 5px; cursor: pointer; }

        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(22, 27, 34, 0.85); backdrop-filter: blur(12px); padding: 6px; border-radius: 20px; display: flex; border: 1px solid #30363d; z-index: 1000; }
        .nav-btn { background: none; border: none; color: #8b949e; padding: 10px 24px; border-radius: 15px; font-weight: 600; font-size: 0.85rem; cursor: pointer; outline: none; }
        .nav-btn.active { background: #30363d; color: #58a6ff; }
        .del-btn { background: none; border: none; color: #484f58; font-size: 1.2rem; cursor: pointer; padding: 0 5px; outline: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="trackerSection" class="view-section active">
        <header>
            <h1>Weekly Progress</h1>
            <div class="week-label" id="currentWeekLabel"></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0%</div>
            </div>
        </header>
        <div class="task-list" id="taskList"></div>
        <div class="input-area">
            <input type="text" id="newTaskName" placeholder="New habit...">
            <input type="number" id="newTaskTarget" value="3">
            <button class="add-btn" onclick="addTask()">Add</button>
        </div>
    </div>
    <div id="historySection" class="view-section">
        <header><h1>History</h1><div class="week-label">Archive</div></header>
        <div id="historyGrid" class="history-grid"></div>
        <div class="data-section">
            <button class="data-btn" onclick="exportData()">Export Backup</button>
            <button class="data-btn" onclick="importData()">Import Backup</button>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('tracker')">Today</button>
    <button class="nav-btn" onclick="switchTab('history')">History</button>
</div>

<script>
    let tasks = JSON.parse(localStorage.getItem('weeklyTasks')) || [];
    let history = JSON.parse(localStorage.getItem('weeklyHistory')) || [];
    let lastReset = localStorage.getItem('lastResetDate');

    function init() { checkWeeklyReset(); updateWeekLabel(); renderTracker(); renderHistory(); }

    function getMonday(d) {
        d = new Date(d); const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        const mon = new Date(d.setDate(diff)); mon.setHours(0,0,0,0);
        return mon;
    }

    function updateWeekLabel() {
        const mon = getMonday(new Date());
        document.getElementById('currentWeekLabel').innerText = "Week of " + mon.toLocaleDateString('en-US', {month:'short', day:'numeric'});
    }

    function checkWeeklyReset() {
        const now = new Date(); const curMon = getMonday(now);
        if (!lastReset) { localStorage.setItem('lastResetDate', curMon.toISOString()); return; }
        if (curMon > new Date(lastReset)) {
            if (tasks.length > 0) {
                let tT = 0, tC = 0; tasks.forEach(t => { tT += t.target; tC += t.completed; });
                const allMet = tasks.every(t => t.completed >= t.target);
                let rawPct = tT === 0 ? 0 : Math.round((tC/tT)*100);
                let archivePct = (rawPct >= 100 && !allMet) ? 99 : rawPct;
                history.unshift({ date: new Date(lastReset).toLocaleDateString('en-US', {month:'short', day:'numeric'}), pct: archivePct });
            }
            tasks.forEach(t => t.completed = 0);
            localStorage.setItem('lastResetDate', curMon.toISOString());
            saveAll();
        }
    }

    function addTask() {
        const n = document.getElementById('newTaskName'), t = document.getElementById('newTaskTarget');
        if (n.value.trim() && t.value > 0) {
            tasks.push({ id: Date.now(), name: n.value.trim(), target: parseInt(t.value), completed: 0 });
            n.value = ''; saveAll(); renderTracker();
        }
    }

    function editTask(id) {
        const t = tasks.find(x => x.id === id);
        const newName = prompt("Edit habit name:", t.name);
        if (newName === null) return;
        const newTarget = prompt("Edit weekly target:", t.target);
        if (newTarget === null) return;
        t.name = newName.trim() || t.name;
        if (!isNaN(newTarget) && newTarget > 0) t.target = parseInt(newTarget);
        saveAll(); renderTracker();
    }

    function toggleDot(id, idx) {
        const t = tasks.find(x => x.id === id);
        t.completed = (idx + 1 === t.completed) ? idx : idx + 1;
        saveAll(); renderTracker();
    }

    function addBonus(id) { tasks.find(x => x.id === id).completed++; saveAll(); renderTracker(); }
    function removeTask(id) { if(confirm('Delete?')) { tasks = tasks.filter(x => x.id !== id); saveAll(); renderTracker(); } }
    function saveAll() { localStorage.setItem('weeklyTasks', JSON.stringify(tasks)); localStorage.setItem('weeklyHistory', JSON.stringify(history)); }

    function renderTracker() {
        const list = document.getElementById('taskList'); list.innerHTML = '';
        let tT = 0, tC = 0;
        tasks.forEach(t => {
            tT += t.target; tC += t.completed;
            const card = document.createElement('div'); card.className = 'task-card';
            let dH = '';
            for (let i=0; i<t.target; i++) dH += `<div class="dot ${i<t.completed?'filled':''}" onclick="toggleDot(${t.id},${i})"></div>`;
            if (t.completed > t.target) for (let i=t.target; i<t.completed; i++) dH += `<div class="dot bonus filled" onclick="toggleDot(${t.id},${i})"></div>`;
            card.innerHTML = `<div class="task-header"><span class="task-title" onclick="editTask(${t.id})">${t.name} <span class="counter-text">(${t.completed}/${t.target})</span></span><button class="del-btn" onclick="removeTask(${t.id})">&times;</button></div><div class="dots-container">${dH}<div class="add-bonus-btn" onclick="addBonus(${t.id})"></div></div>`;
            list.appendChild(card);
        });
        updateBar(tC, tT);
    }

    function updateBar(c, t) {
        const bar = document.getElementById('progressBar'); const txt = document.getElementById('progressText');
        if (tasks.length === 0) { bar.style.width = '0%'; txt.innerText = '0%'; return; }
        const rawPct = t === 0 ? 0 : Math.round((c / t) * 100);
        const allTasksMet = tasks.every(task => task.completed >= task.target);
        let isOverdrive = (rawPct > 100 && allTasksMet);
        let displayPct = (rawPct >= 100 && !allTasksMet) ? 99 : rawPct;
        bar.style.width = `${Math.min(displayPct, 100)}%`;
        bar.classList.toggle('overdrive', isOverdrive);
        txt.innerText = `${displayPct}%${(rawPct >= 100 && !allTasksMet) ? ' ðŸ”’' : ''}`;
    }

    function renderHistory() {
        const grid = document.getElementById('historyGrid');
        grid.innerHTML = history.length ? '' : '<div style="grid-column:1/3; color:#484f58; text-align:center; padding:40px;">No history yet.</div>';
        history.forEach(e => {
            const color = e.pct >= 100 ? 'var(--overdrive-purple)' : 'var(--accent-color)';
            const grad = `conic-gradient(${color} ${Math.min(e.pct, 100)}%, #21262d 0)`;
            const card = document.createElement('div'); card.className = 'history-card';
            card.innerHTML = `<div style="font-size:0.75rem; color:#8b949e">${e.date}</div><div class="ring-container"><div class="ring-fill" style="background:${grad}"></div><div class="ring-inner"></div><div class="ring-text">${e.pct}%</div></div>`;
            grid.appendChild(card);
        });
    }

    function exportData() { 
        try {
            const data = btoa(JSON.stringify({tasks, history, lastReset})); 
            navigator.clipboard.writeText(data); 
            alert('Backup code copied to clipboard! Save this in a note.'); 
        } catch(e) { alert('Export failed. Ensure you are using HTTPS.'); }
    }
    function importData() { 
        const code = prompt('Paste backup code:'); 
        if (code) { 
            try { 
                const parsed = JSON.parse(atob(code)); 
                tasks = parsed.tasks || []; 
                history = parsed.history || []; 
                lastReset = parsed.lastReset || null; 
                saveAll(); location.reload(); 
            } catch(e) { alert('Invalid backup code.'); } 
        } 
    }
    function switchTab(t) { 
        document.getElementById('trackerSection').classList.toggle('active', t === 'tracker'); 
        document.getElementById('historySection').classList.toggle('active', t === 'history'); 
        document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', (t==='tracker'?i===0:i===1))); 
    }

    init();
</script>
</body>
</html>
